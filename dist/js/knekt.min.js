function getNGramCount(a,b,c){if("string"!==typeof a)throw TypeError("text must be a string");if("number"!==typeof b)throw TypeError("n must be a number");if(1>b)throw RangeError("n must be greater than or equal to one");if("number"!==typeof c)throw TypeError("count must be a number");if(0>c)throw RangeError("count must be non-negative");a=a.toUpperCase();for(var d={},e="",f=0;f<=a.length-b;f++)e=a.slice(f,f+b),d[e]=d[e]?d[e]+1:1;a=[];for(e in d)d.hasOwnProperty(e)&&a.push({ngram:e,num:d[e]});a.sort(function(a,
b){return b.num-a.num});return a.slice(0,c)}function createEmptyContext(a){for(var b=[],c=0;c<a;c++)b.push({ngram:"-",num:"-"});return b};function updateBigramFactorTable(a){handlebarExec("#bigram-factor-table-template","#bigram-factor-table",{bigram:getBigramFactors(a)})}function initBigramFactorMngr(){document.body.addEventListener("fileChange",function(a){updateBigramFactorTable(a.detail)})};function handlebarAlphabetDivs(a){if("object"!==typeof a)throw Error("alphabet must be an object");var b={letters:[]},c;for(c in a)a.hasOwnProperty(c)&&b.letters.push(c.toUpperCase());handlebarExec("#orig-alphabet-hbs","#plain-cryptobet .normal-alphabet",b);handlebarExec("#orig-alphabet-hbs","#crypto-plainbet .normal-alphabet",b)}
function handlebarCryptobetDivs(a){if("object"!==typeof a)throw Error("alphabet must be an object");var b={letters:[]},c;for(c in a)a.hasOwnProperty(c)&&b.letters.push("");handlebarExec("#crypto-alphabet-hbs","#crypto-alphabet",b);handlebarExec("#crypto-alphabet-hbs","#plain-alphabet",b)}
function handlebarMessageDivs(a,b){if("undefined"==typeof a.length||"undefined"==typeof a.substr)throw Error("a message needs a length");if("object"!==typeof b)throw Error("alphabet must be an object");for(var c=Math.ceil(a.length/60),d={row:[]},e=0;e<c;++e){var f="PLACEHOLDER";a&&(f=a.substr(60*e,60));d.row.push({encrypted:f,decrypted:decryptLine(f,b)})}handlebarExec("#message-divs-hbs","#message-divs",d)};(function(){function a(a,c){c=c||{bubbles:!1,cancelable:!1,detail:void 0};var d=document.createEvent("CustomEvent");d.initCustomEvent(a,c.bubbles,c.cancelable,c.detail);return d}if("function"===typeof window.CustomEvent)return!1;a.prototype=window.Event.prototype;window.CustomEvent=a})();function AppState(a,b){var c=a,d=b,e="",f={};this.getLang=function(){return c};this.getFileName=function(){return d};this.getFileText=function(){return e};this.fileIsSelected=function(){return void 0!==d};this.applySettings=function(){var a=$("#lang-select"),b=$("#file-select");a.hasClass("changed-setting")&&(c=a.val(),a=new CustomEvent("languageChange",{detail:c}),document.body.dispatchEvent(a));b.hasClass("changed-setting")&&(d=b.val(),h());clearSettingIndications();$("#apply-button").prop("disabled",
!0)};var g=function(a){return(a=f[a])?a:null},h=function(){var a=g(d);a?(e=a,a=new CustomEvent("fileChange",{detail:e}),document.body.dispatchEvent(a)):$.ajax({url:appConfig.CRYPTO_TEXT_PATH+"/"+d,dataType:"text",success:function(a){e=a=a&&a.toUpperCase();f[d]||(f[d]=e);a=new CustomEvent("fileChange",{detail:a});document.body.dispatchEvent(a)},error:function(){alert("Failed to get file.");console.log("AJAX-call to get text file failed.")}})}}var appState;
function initAppState(){appState=new AppState($("#lang-select").val(),$("#file-select").val());$("#apply-button").prop("disabled",!0)}
function settingsChange(a){var b=$("#file-select"),c=$("#lang-select"),d;if("lang"===a)d=appState.getLang(),a=c;else if("file"===a)d=appState.getFileName(),a=b;else throw Error("No setting of type: "+a);a.val()!==d?(a.addClass("changed-setting"),a.children().each(function(){$(this).val()===d&&$(this).addClass("last-setting")})):(a.removeClass("changed-setting"),$("option:selected",a).removeClass("last-setting"));b=!(c.hasClass("changed-setting")||b.hasClass("changed-setting"));$("#apply-button").prop("disabled",
b)}function clearSettingIndications(){var a=$("#lang-select"),b=$("#file-select");a.removeClass("changed-setting");b.removeClass("changed-setting");a.children("option").removeClass("last-setting");b.children("option").removeClass("last-setting")};function initSubstMngr(){substResetTool();document.body.addEventListener("fileChange",function(a){substResetTool("fileChange",a.detail)});document.body.addEventListener("languageChange",function(){substResetTool("resetDecrypted")})}
function setupInputCallbacks(){var a=$(".alphabet-editable").children();a.on("keydown",function(){moveCaretToStart(this)});a.keyboardEvents("backspace del",function(){var a=$(this);a.isEmpty()?a.prev().focus():(a.html(""),updatePartnerSubstBet(this))});a.keyboardEvents("newline right",function(){$(this).next().focus()});a.keyboardEvents("left",function(){$(this).prev().focus()});a.keyboardEvents("up down",function(){var a=this.parentNode,c;"plain-alphabet"===a.id?c=$("#crypto-alphabet"):"crypto-alphabet"===
a.id&&(c=$("#plain-alphabet"));a=$(this).index();c.children().eq(a).focus()});a.on("input",function(){var a=$(this),c=a.html(),d=$("#lang-select").val();c.match(getRegexForLang(d))?0<c.length&&a.html(c.charAt(0).toUpperCase()):(console.log("subst: illegal char entered"),a.html(""));updatePartnerSubstBet(this);return!0})}
function updatePartnerSubstBet(a,b){var c;c=a.parentNode;var d={};"plain-alphabet"===c.id?d=updateSubstAlphabets("#plain-alphabet","#crypto-alphabet"):"crypto-alphabet"===c.id&&(d=updateSubstAlphabets("#crypto-alphabet","#plain-alphabet"),d.val&&(d.val=invertObject(d.val)));c=d;d=$(a);c.dupes?(d.html(""),b||(updatePartnerSubstBet(a,!0),flashDupes(c.dupes,d))):b||1!==d.html().length||d.is(":focus")&&d.next().focus();updateMessageDivs(c.val);return!0}
function updateSubstAlphabets(a,b){var c=$(a).children().toInnerHTMLArray(),d=getDuplicates(c);if(0!=objectSize(d))return{dupes:d};var e=[],f={},d=$(a).siblings(".normal-alphabet").children();d.each(function(a,b){e[a]=b.innerHTML;var d=c[a];d&&(f[d]=b.innerHTML)});var g=$(b).children();g.each(function(a,b){var c=f[e[a]]||"";$(b).html(c)});var h=function(a,b){a.removeClass("transparent-letter").each(function(){-1<b.indexOf(this.innerHTML)&&$(this).addClass("transparent-letter")})},k=$(b).siblings(".normal-alphabet").children(),
g=g.toInnerHTMLArray();h(d,c);h(k,g);return{val:f}}function updateMessageDivs(a){if("object"!==typeof a)return!1;var b=$("#message-divs"),c=$(".decr-msg-row",b),d=$(".encr-msg-row",b).toInnerHTMLArray(),e=0;c.each(function(b,c){var h=decryptLine(d[b],a);h!==c.innerHTML&&(e++,$(c).html(h))});console.log("subst:",e,"line(s) affected by update");return!0}
function substResetTool(a,b){var c=initAlphabet(appState.getLang());"fileChange"==a&&b&&handlebarMessageDivs(b,c);console.log("subst: resetting tool");handlebarAlphabetDivs(c);handlebarCryptobetDivs(c);setupInputCallbacks();"resetDecrypted"==a&&updateMessageDivs(c)}function substDrop(a){var b=a.dataTransfer;b&&a.target&&b.getData?(a.target.innerHTML=b.getData("source"),$(a.target).blur(),$(a.target).trigger("input")):alert("dropping not supported by this browser");a.preventDefault()}
function substDrag(a){var b=a.dataTransfer;b&&a.target&&b.setData?b.setData("source",a.target.innerHTML):(alert("drag-and-drop is not supported on this browser"),a.preventDefault())};$(function(){initAppState();initInterface();initBigramFactorMngr();initNGramTablesMngr();initStatChartsMngr();initHomeMngr();initViewMngr();initSubstMngr();initTransMngr();initVigMngr();initAbout()});var caesarLookUp=function(a,b,c){if("string"!==typeof a||"string"!==typeof b||"string"!==typeof c)throw new TypeError("Argument is not a string");if(""===a||""===b||""===c)throw Error("Argument is empty string");var d=c.indexOf(a);if(-1===d)return console.log("vig:Cryptoletter not in alphabet"),"?";b=c.indexOf(b);if(-1===b)throw Error("Key is not in the alphabet");a=c.indexOf(a,b);return c[-1===a?c.length-b+d:a-b]},caesarReverseLookUp=function(a,b,c){a=c.indexOf(a);b=c.indexOf(b);return c[(a+b)%c.length]},
decipherVigenereString=function(a,b,c){if("string"!==typeof a||"string"!==typeof b||"string"!==typeof c)throw new TypeError("Argument is not a string");var d=b.length,e=a.length,f="";c=getAlphabet(c);for(var g=0;g<e;g++)f+=caesarLookUp(a[g],b[g%d],c);return f},encryptVigenere=function(a,b,c){for(var d=0,e=b.length,f=a.length,g="",h=0;h<f;h++)g+=caesarReverseLookUp(a[h],b[d],c),d=(d+1)%e;return g},vigLetterGraph=function(a,b,c,d){if("number"!==typeof a||0>a||a>=b)throw Error("I cannot let you do that, Dave");
if(!d||"object"!==typeof d)throw Error("alphaObj must be an object");for(var e="";a<c.length;a+=b)e+=c[a];countLetterFrequency(e,d);return{name:"Vigenere offset alphabet",data:getValuesFromObject(d)}},shiftArray=function(a,b){if("number"!==typeof b||"object"!==typeof a)throw Error("shiftArray: invalid parameters");for(var c=[],d=0;d<a.length;++d)c.push(a[(d+b+a.length)%a.length]);return c};var utilState=utilState||{};function initViewMngr(){initUtilState();initUtilDrag()}function initUtilState(){var a=[];$("#util-tools").children(".graph-container").each(function(){a.push(this)});$("#cipher-tool").children().each(function(){utilState[this.id]={order:a,openTools:{}}});utilState.HOME="home-view";utilState.activeView=utilState.HOME}
function initUtilDrag(){dragula([document.querySelector(".graph-area")],{revertOnSpill:!0,direction:"vertical",moves:function(a,b,c){return c.classList.contains("graph-container-header")}}).on("drop",function(){saveUtilOrder()})}
function viewChange(a,b){var c=a!==utilState.activeView;a==utilState.HOME?$(".tool-button").removeClass("tool-button-active"):($(".tool-button").not(this).removeClass("tool-button-active"),$(b).addClass("tool-button-active"));$("#cipher-tool").children().each(function(){this.id!==a?$(this).hide():($(this).show(),utilState.activeView=this.id,$(this).trigger("viewChange"))});c&&loadUtilState()}
function expandCollapseGraph(a){a=$(a).parent();var b=a.attr("id");if(!a.children("graph-container-content").is(":animated")){var c=utilState[utilState.activeView].openTools[b];utilState[utilState.activeView].openTools[b]=!c;setVisibilityOf(a,!c);window.dispatchEvent(new Event("resize"))}}
function setVisibilityOf(a,b){a=$(a);var c=a.children(".graph-container-content"),d=a.children(".graph-container-header").children(0);$(d).removeClass();$(d).addClass(b?"arrow-down":"arrow-right");b?$(c).stop().slideDown(200):$(c).stop().slideUp(200)}function saveUtilOrder(){var a=[];$("#util-tools").children(".graph-container").each(function(){a.push(this)});utilState[utilState.activeView].order=a}
function loadUtilState(){var a=function(){for(var a=utilState[utilState.activeView].order,d=0;d<a.length-1;d++)$(a[d+1]).insertAfter(a[d]);setTimeout(b,200)},b=function(){$("#util-tools").children(".graph-container").each(function(){utilState[utilState.activeView].openTools[this.id]&&setVisibilityOf(this,!0)});window.dispatchEvent(new Event("resize"))};(function(){$("#util-tools").children(".graph-container").each(function(){setVisibilityOf(this,!1)});setTimeout(a,200)})()};var redrawFixedGraph=function(){var a=$("#lang-select").val();"sv"===a?plotGraph("#vig-fixed-graph",swedishGraphData,"Swedish letter statistics","column",Object.keys(swedishStats),"Frequency (%)",!0):"en"===a&&plotGraph("#vig-fixed-graph",englishGraphData,"English letter statistics","column",Object.keys(englishStats),"Frequency (%)",!0)},redrawShiftableGraph=function(a,b){var c=appState.getLang(),d=appState.getFileText();if(appState.fileIsSelected()){if($(".vig-active-letter").get(0)){var e=getVigKey(),
c=initAlphabet(c),f;for(f in c)c.hasOwnProperty(f)&&(c[f]=0);d=vigLetterGraph(a,e.length,d,c);d.data=shiftArray(d.data,b);d.color=bar_color;e=shiftArray(Object.keys(c),b);plotGraph("#vig-movable-graph",d,"Letters shifted by selected key letter","column",e,"Occurrences",!1);return!0}plotGraph("#vig-movable-graph",initAlphabet(c),"Please select a key letter","column",{},"",!1,"Please select a key letter")}else plotGraph("#vig-movable-graph",initAlphabet(c),"Please choose a file","column",{},"",!1,"No file loaded")},
handlebarVigenereKey=function(a,b){if("number"!==typeof a)throw Error("keyLength must be an number");for(var c={keyLetter:[]},d=0;d<a;++d)c.keyLetter.push("A");b=b||{};d=$("#vigenere-key-hbs").html();d=handlebarCompile(d);c=handlebarBuild(d,c);d=$("#vig-key");if(!b.resetKey){var e=$("<div></div>");e.html(c);var f=d.children();e.children().each(function(a,b){var c=f.get(a);c&&($(b).html(c.innerHTML),$(b).addClass(c.className))});c=e.html()}d.html(c)};function memoize(a){var b={};return function(){var c=String(Hashcode.value(JSON.stringify(arguments))>>>0);return b[c]=b[c]||a.apply(this,arguments)}}function getValuesFromObject(a){if(null===a||"object"!==typeof a)throw new TypeError("Not an object!");var b=[],c;for(c in a)Object.prototype.hasOwnProperty.call(a,c)&&b.push(a[c]);return b}
var getAlphabet=function(a){if("en"===a)return"ABCDEFGHIJKLMNOPQRSTUVWXYZ";if("sv"===a)return"ABCDEFGHIJKLMNOPQRSTUVWXYZ\u00c5\u00c4\u00d6";if("string"!==typeof a)throw new TypeError("Argument is not a string");throw Error("Language not recognized");};
jQuery.fn.keyboardEvents=function(a,b){var c={backspace:8,del:46,newline:13,tab:9,right:39,left:37,up:38,down:40};if("function"!==typeof b)throw Error("keyboardEvents expects callback to be a function");if("number"!==typeof a.length)throw Error("keyboardEvents expects keys to have a length property");"string"===typeof a&&(a=a.toLowerCase().split(" "));for(var d={},e=0;e<a.length;++e){var f=c[a[e]];f&&(d[f]=!0)}return this.on("keydown",function(a){var c=a.currentTarget;return a.keyCode in d?(jQuery.proxy(b,
c)(),!1):!0})};function updateTextNGgramTables(a){var b={label:"Bigram",numType:"Count"},c={label:"Trigram",numType:"Count"};appState.fileIsSelected()?(b.ngrams=getNGramCount(a,2,10),c.ngrams=getNGramCount(a,3,10)):(a=createEmptyContext(10),b.ngrams=a,c.ngrams=a);handlebarExec("#ngram-table-template","#text-bigram-table",b);handlebarExec("#ngram-table-template","#text-trigram-table",c)}
function plotLanguageNGramTables(a,b){handlebarExec("#ngram-table-template","#language-bigram-table",a);handlebarExec("#ngram-table-template","#language-trigram-table",b)}
function updateLanguageNGramTables(a){var b={ngrams:[{ngram:"EN",num:2.81},{ngram:"ER",num:2.51},{ngram:"DE",num:2.37},{ngram:"AR",num:2.02},{ngram:"AN",num:1.88},{ngram:"ET",num:1.65},{ngram:"IN",num:1.65},{ngram:"ST",num:1.42},{ngram:"TE",num:1.41},{ngram:"TT",num:1.36}],label:"Bigram",numType:"Frequency"},c={ngrams:[{ngram:"TH",num:3.88},{ngram:"HE",num:3.68},{ngram:"IN",num:2.28},{ngram:"ER",num:2.18},{ngram:"AN",num:2.14},{ngram:"RE",num:1.75},{ngram:"ND",num:1.57},{ngram:"ON",num:1.42},{ngram:"EN",
num:1.38},{ngram:"AT",num:1.34}],label:"Bigram",numType:"Frequency"},d={ngrams:[{ngram:"F\u00d6R",num:1.05},{ngram:"ATT",num:.86},{ngram:"ING",num:.83},{ngram:"OCH",num:.82},{ngram:"TER",num:(.7).toFixed(2)},{ngram:"DET",num:.66},{ngram:"AND",num:.62},{ngram:"NDE",num:(.6).toFixed(2)},{ngram:"SOM",num:.58},{ngram:"DEN",num:.57}],label:"Trigram",numType:"Frequency"},e={ngrams:[{ngram:"THE",num:3.51},{ngram:"AND",num:1.59},{ngram:"ING",num:1.15},{ngram:"HER",num:.82},{ngram:"HAT",num:.65},{ngram:"HIS",
num:(.6).toFixed(2)},{ngram:"THA",num:.59},{ngram:"ERE",num:.56},{ngram:"FOR",num:.56},{ngram:"ENT",num:.53}],label:"Trigram",numType:"Frequency"};"sv"===a?plotLanguageNGramTables(b,d):"en"===a&&plotLanguageNGramTables(c,e)}
function initNGramTablesMngr(){document.body.addEventListener("languageChange",function(a){updateLanguageNGramTables(a.detail)});document.body.addEventListener("fileChange",function(a){updateTextNGgramTables(a.detail)});updateLanguageNGramTables(appState.getLang());updateTextNGgramTables()};var nCols=4;function updateResultText(){for(var a=document.querySelectorAll("#column-container > .trans-column"),b=[],c=0,d=0;d<a.length;d++)c=parseInt(a[d].getAttribute("data-index"))-1,b.push(c);a=decryptTransposition(nCols,b,appState.getFileText());$("#trans-result").html(a)}function columnIncrDecr(a){appState.fileIsSelected()&&(nCols+=a,9<nCols?nCols=9:2>nCols?nCols=2:generateNewColumns())}
function resetTransTool(){if(appState.fileIsSelected()){nCols=4;var a=getHandlebarsColumns(nCols,padText(nCols,appState.getFileText())),b=handlebarCompile($("#trans-col-template").html()),a=handlebarBuild(b,a);$("#column-container").html(a);updateResultText()}}
function orderColumns(a,b){var c=[];a.each(function(a,e){var f=$(e).attr("data-index"),g=b.filter(function(a,b){return $(b).attr("data-index")==f});0<g.length&&c.push(g.get(0))});c.length&&b.length>c.length&&c.push(b.last().get(0));return c}
function generateNewColumns(){var a=padText(nCols,appState.getFileText()),a=getHandlebarsColumns(nCols,a),b=$("#trans-col-template").html(),b=handlebarCompile(b),b=handlebarBuild(b,a),a=$("#column-container"),c=$("<div></div>").html(b),d=a.children(),c=c.children(),b=0<d.length?orderColumns(d,c):b;a.html(b);updateResultText()}
function initTransMngr(){document.body.addEventListener("fileChange",function(a){$("#trans-result").html("");generateNewColumns()});dragula([document.querySelector("#column-container")],{revertOnSpill:!1,direction:"horizontal"}).on("drop",function(){updateResultText()})};var initInterface=function(){createFileSelect();disableToolButtonBorder();initCustomScrollbars()},createFileSelect=function(){for(var a=[],b=function(a,b){a+="";return a.length>=b?a:Array(b-a.length+1).join("0")+a},c=1;c<=appConfig.TEXT_FILE_COUNT;c++)a.push(b(c,3));handlebarExec("#file-select-template","#file-section",{number:a})},disableToolButtonBorder=function(){$(".tool-button").on("focus",function(){$(this).blur()})},handlebarCompile=memoize(function(a){return Handlebars.compile(a)}),handlebarBuild=
memoize(function(a,b){return a(b)}),handlebarExec=function(a,b,c){if("object"!==typeof c)throw Error("Context passed to handlebar must be an object");if("string"!==typeof a||"string"!==typeof b)throw Error("Selectors must be strings");a=$(a);b=$(b);if(0===a.length||0===b.length)throw Error("Script or target does not exist");a=a.html();a=handlebarCompile(a);c=handlebarBuild(a,c);b.html()!==c&&b.html(c)},flashDupes=function(a,b){var c=b.siblings().filter(function(b,c){var f=c.innerHTML;if(f in a)return a.hasOwnProperty(f)});
flashSelectionRed(c)},flashSelectionRed=function(a){a.addClass("redBackground");window.setTimeout(function(){a.removeClass("redBackground").addClass("defaultBackground")},1E3)},moveCaretToStart=function(a){if(a instanceof Node&&window.getSelection&&document.createRange){var b=document.createRange();b.selectNodeContents(a);b.collapse(!0);a=window.getSelection();a.removeAllRanges();a.addRange(b)}else b=a.innerHTML,a.innerHTML="",a.innerHTML=b},initCustomScrollbars=function(){$(window).load(function(){$("#column-container-wrapper").mCustomScrollbar({axis:"y"});
$("#util-bar").mCustomScrollbar({axis:"y"})})};function initHomeMngr(){document.body.addEventListener("fileChange",function(a){var b=$("#home-text-area");$("#home-no-file").hide();b.html(a.detail);b.show()})};function getBigramDistances(a,b){for(var c=[],d=a.indexOf(b);-1!==d;){for(var e=0;e=a.indexOf(b,e+d+1),-1!==e;)c.push(e-d);d=a.indexOf(b,d+1)}return c}function getBigramFactors(a){for(var b=getNGramCount(a,2,50),c=[{nr:2,count:0},{nr:3,count:0},{nr:4,count:0},{nr:5,count:0},{nr:6,count:0},{nr:7,count:0},{nr:8,count:0}],d=0;d<b.length;d++)for(var e=getBigramDistances(a,b[d].ngram),f=2;f<c.length+2;f++)for(var g=0;g<e.length;g++)0===e[g]%f&&(c[f-2].count+=1);return c};function initAbout(){var a=$("#about-button"),b=$("#about-close-button"),c=$("#about-overlay"),d=function(a){!c.is(":visible")||$(a.target).closest("#about-overlay").length||$(a.target).is("#about-button")||(c.hide(),$(document).unbind("click",d))};a.click(function(){c.show();$(document).click(d)});b.click(function(){c.hide();$(document).unbind("click",d)});$(document).keyup(function(a){27===a.keyCode&&(c.hide(),$(document).unbind("click",d))})};function buildList(a,b){for(var c=[],d=0;d<b;d++)c.push(a);return c}function calculateColumns(a,b){if("string"!==typeof b)throw new TypeError("text not a string");if("number"!==typeof a)throw new TypeError("nCols not a number");if(0>=a)throw new RangeError("nCols smaller than 1");for(var c=buildList("",a),d=0;d<b.length;d++)c[d%a]+=b[d];return c}
function decryptTransposition(a,b,c){for(var d=calculateColumns(a,c),e="",f=0,f="",g=0;g<c.length+a;g++)f=b[g%a],f=d[f][Math.floor(g/a)],e+=f?f:"";return e}function padText(a,b){var c=b;if(0!==b.length%a)for(var d=0;d<a-b.length%a;d++)c+=" ";return c}function getHandlebarsColumns(a,b){for(var c={column:[]},d=calculateColumns(a,b),e=0;e<a;e++)c.column.push({number:e+1,letters:d[e].split("")});return c};var appConfig=appConfig||{};appConfig.CRYPTO_TEXT_PATH="res";appConfig.TEXT_FILE_COUNT=102;var initVigMngr=function(){document.body.addEventListener("fileChange",function(a){resetVigenere()});document.body.addEventListener("languageChange",resetVigenere);resetVigenere();$("#vig-tool").one("viewChange",function(){window.dispatchEvent(new Event("resize"))})},resetVigenere=function(){handlebarVigenereKey(3,{resetKey:!0});vigenereSetupInputCallbacks();updateVigenereText();redrawFixedGraph();recalculateShiftedGraph();$(".vig-shift-button").addClass("blur-active")},vigenereSetupInputCallbacks=
function(){var a=$(".vigenere-key");a.on("keypress",function(){moveCaretToStart(this)});a.keyboardEvents("right",function(){$(this).next().focus()});a.keyboardEvents("left",function(){$(this).prev().focus()});a.on("input",function(){var a=$(this),c=a.html(),d=$("#lang-select").val();c.match(getRegexForLang(d))?a.html(c.charAt(0).toUpperCase()):(console.log("vig: illegal char entered"),a.html(""));updateVigenereText();recalculateShiftedGraph(this)});a.on("focus",function(){$(this).siblings().removeClass("vig-active-letter");
$(this).addClass("vig-active-letter");recalculateShiftedGraph(this)});$("#vig-buttons").children("button").on("click",function(){$(this).hasClass("button-plus")?vigKeyLenAdjust(1):vigKeyLenAdjust(-1);recalculateShiftedGraph(this)});$(".vig-left-shift-button").off("click").on("click",function(){$(this).hasClass("blur-active")||(vigShift(1),recalculateShiftedGraph(),updateVigenereText())});$(".vig-right-shift-button").off("click").on("click",function(){$(this).hasClass("blur-active")||(vigShift(-1),
recalculateShiftedGraph(),updateVigenereText())})},vigShift=function(a){var b=$(".vig-active-letter").get(0);if(b){var c=$("#lang-select").val(),c=getAlphabet(c),d=c.indexOf(b.innerHTML);-1===d?console.log("active letter not in alphabet"):b.innerHTML=c[(d+a+c.length)%c.length]}},recalculateShiftedGraph=function(a){if((a=a||$(".vig-active-letter").get(0))&&a.innerHTML){var b=a.innerHTML,c=$("#lang-select").val(),c=getAlphabet(c),b=c.indexOf(b),b=(c.length+b)%c.length;a=parseInt(a.getAttribute("data-key-index"));
a=redrawShiftableGraph(a,b)}else a=redrawShiftableGraph(0,0);a?$(".vig-shift-button").removeClass("blur-active"):$(".vig-shift-button").addClass("blur-active")},vigKeyLenAdjust=function(a){a=$(".vigenere-key").length+a;2<=a&&8>=a&&handlebarVigenereKey(a);vigenereSetupInputCallbacks();updateVigenereText()},updateVigenereText=function(){var a=getVigKey(),b=appState.getLang(),c=appState.getFileText();$("#vig-result").text(decipherVigenereString(c,a,b))},getVigKey=function(){var a="";$(".vigenere-key").each(function(){a+=
$(this).text()||"A"});return a};function countLetterFrequency(a,b){if("string"!==typeof a)throw new TypeError("Not a string!");if(null===b||"object"!==typeof b)throw new TypeError("Not an object!");for(var c=a.toUpperCase(),d=0,e=c.length;d<e;d++)c[d]in b&&b[c[d]]++}function getTextLetterFrequencySwe(a){var b={A:0,B:0,C:0,D:0,E:0,F:0,G:0,H:0,I:0,J:0,K:0,L:0,M:0,N:0,O:0,P:0,Q:0,R:0,S:0,T:0,U:0,V:0,W:0,X:0,Y:0,Z:0,"\u00c5":0,"\u00c4":0,"\u00d6":0};a&&countLetterFrequency(a,b);return b}
function getTextLetterFrequencyEng(a){var b={A:0,B:0,C:0,D:0,E:0,F:0,G:0,H:0,I:0,J:0,K:0,L:0,M:0,N:0,O:0,P:0,Q:0,R:0,S:0,T:0,U:0,V:0,W:0,X:0,Y:0,Z:0};a&&countLetterFrequency(a,b);return b};function initAlphabet(a){if(!Array.prototype.reduce)throw Error("Browser does not have array.reduce");return getAlphabet(a).toUpperCase().split("").reduce(function(a,c){a[c]="_";return a},{})}
function decryptLine(a,b){if("object"!==typeof b)throw Error("cannot decrypt without a substitution alphabet object");if("undefined"==typeof a.length||"function"!=typeof a.charAt)throw Error("cannot decrypt lines that does not have a length or index");for(var c="",d=0,e=a.length;d<e;d++)var f=a.charAt(d),c=c+(b[f]||"_");return c}function objectSize(a){var b=0;if("object"!==typeof a)throw Error("objectSize does not like non-objects as parameters");for(var c in a)a.hasOwnProperty(c)&&++b;return b}
function getDuplicates(a){if(!a||"undefined"==typeof a.length)throw Error("Array must have a defined length");for(var b={},c=0,d=a.length;c<d;++c){var e=a[c];e&&(b[e]=b[e]?b[e]+1:1)}a={};for(var f in b)b.hasOwnProperty(f)&&1<b[f]&&(a[f]=b[f]);return a}function getRegexForLang(a){var b=/^[a-z]+$/i,c=/^[a-z\u00e5\u00e4\u00f6]+$/i;if("sv"===a)return c;if("en"===a)return b;throw Error("Lang not 'en' or 'sv'");}
function invertObject(a){if("object"!==typeof a)throw Error("can't invert non-objects");var b={},c;for(c in a)a.hasOwnProperty(c)&&(b[a[c]]=c);return b}jQuery.fn.toInnerHTMLArray=function(){var a=[];this.each(function(b,c){a.push(c.innerHTML.trim(""))});return a};jQuery.fn.isEmpty=function(){return""==jQuery.trim(this.html())};var chart_font=window.getComputedStyle(document.querySelector("html")).getPropertyValue("--chartFont"),bar_color=window.getComputedStyle(document.querySelector("html")).getPropertyValue("--bar-color"),swedishStats={A:9.383,B:1.535,C:1.486,D:4.702,E:10.149,F:2.027,G:2.862,H:2.09,I:5.817,J:.614,K:3.14,L:5.275,M:3.471,N:8.542,O:4.482,P:1.839,Q:.02,R:8.431,S:6.59,T:7.691,U:1.919,V:2.415,W:.142,X:.159,Y:.708,Z:.07,"\u00c5":1.338,"\u00c4":1.797,"\u00d6":1.305},englishStats={A:8.167,B:1.492,C:2.782,D:4.253,
E:12.702,F:2.228,G:2.015,H:6.094,I:6.966,J:.153,K:.772,L:4.025,M:2.406,N:6.749,O:7.507,P:1.929,Q:.095,R:5.987,S:6.327,T:9.056,U:2.758,V:.978,W:2.36,X:.15,Y:1.974,Z:.074};try{var swedishGraphData={name:"Swedish",data:getValuesFromObject(swedishStats),font:chart_font,color:bar_color},englishGraphData={name:"English",data:getValuesFromObject(englishStats),font:chart_font,color:bar_color}}catch(a){a instanceof TypeError&&console.log("Invalid stats parameter when calling getValuesFromObject:"+a.message)}
var cryptoGraphData={name:"",data:[],color:bar_color,font:chart_font},plotGraph=function(a,b,c,d,e,f,g,h,k){k=k||function(){return this.x+": <b>"+this.y+"</b>"};h=h||"No data available";$(a).highcharts({chart:{type:d,style:{fontFamily:chart_font,fontSize:"12px"}},title:{text:c,style:{fontFamily:chart_font,fontSize:"14px"}},xAxis:{categories:e,labels:{step:1}},yAxis:{title:{text:f},tickInterval:3,min:0},legend:{enabled:!1},tooltip:{formatter:k},plotOptions:{series:{pointPadding:0,groupPadding:.1,borderWidth:0,
shadow:!1,animation:g}},lang:{noData:h},credits:!1,series:[b]})},setCryptoGraphData=function(a,b){"sv"===a?cryptoGraphData.name="Swedish":"en"===a&&(cryptoGraphData.name="English");if(appState.getFileText())try{cryptoGraphData.data=getValuesFromObject(b)}catch(c){c instanceof TypeError&&console.log("Invalid parameter stats: "+c.message)}else cryptoGraphData.data=[]},plotGraphs=function(a){var b,c=appState.getFileText();"sv"===a?(plotGraph("#language-stats-area",swedishGraphData,"Swedish letter statistics",
"column",Object.keys(swedishStats),"Frequency (%)",!0),appState.fileIsSelected()&&(b=getTextLetterFrequencySwe(c))):"en"===a&&(plotGraph("#language-stats-area",englishGraphData,"English letter statistics","column",Object.keys(englishStats),"Frequency (%)",!0),appState.fileIsSelected()&&(b=getTextLetterFrequencyEng(c)));c="";setCryptoGraphData(a,b);appState.fileIsSelected()&&(c=Object.keys(b));plotGraph("#crypto-stats-area",cryptoGraphData,"Loaded text letter statistics","column",c,"Occurrences",!0,
"No file loaded")},initStatChartsMngr=function(){document.body.addEventListener("languageChange",function(a){plotGraphs(appState.getLang())});document.body.addEventListener("fileChange",function(a){plotGraphs(appState.getLang())});plotGraphs(appState.getLang())};
